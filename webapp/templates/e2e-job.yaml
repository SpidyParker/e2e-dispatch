apiVersion: batch/v1
kind: Job
metadata:
  name: e2e-test-trigger
  annotations:
    argocd.argoproj.io/hook: PostSync
    argocd.argoproj.io/hook-delete-policy: HookSucceeded
spec:
  template:
    metadata:
      labels:
        name: api-test
    spec:
      containers:
      - name: api-test
        args:
            - /bin/sh
            - -ec
            - "curl -X POST -H \"Accept: application/vnd.github.v3+json\" -H \"Authorization: token ${GITHUB_TOKEN}\" ${GITHUB_URL} -d '{\"ref\":\"main\"}'"
        env:
          - name: GITHUB_URL
            value: "https://api.github.com/repos/SpidyParker/e2e-dispatch//actions/workflows/e2e.yaml/dispatches"
          - name: GITHUB_TOKEN 
            valueFrom: 
            secretKeyRef: 
                name: github-token 
                key: token
        image: curlimages/curl
      restartPolicy: OnFailure